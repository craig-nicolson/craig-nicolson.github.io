import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{S as O}from"./signalBatchRenderer-E0200ibZ.js";class Y{constructor(){this.overlayEl=null,this.open=!1,this.fpsEnabled=!1,this.fpsEl=null,this.lastFpsSample=performance.now(),this.frames=0,this.smoothFps=null,this.boundLoop=null,this.currentConfig=null,this.initialized=!1}init(){this.initialized||(this.ensureOverlayElement(),this.setupGlobalHotkeys(),this.startFpsLoop(),this.initialized=!0)}configure(e){this.currentConfig=e,this.updateOverlayContent(),this.setupConfigForm()}updateConfig(e){if(!this.currentConfig){this.configure(e);return}this.currentConfig={...this.currentConfig,...e},this.updateOverlayContent(),this.setupConfigForm()}ensureOverlayElement(){if(this.overlayEl)return;const e=document.createElement("div");e.id="config-overlay",e.innerHTML=this.overlayHTML(),document.body.appendChild(e),this.overlayEl=e,e.querySelector("[data-close]").addEventListener("click",()=>this.toggleOverlay(!1)),e.style.display="none"}overlayHTML(){return`
      <div class="config-header">
        <h3>${this.currentConfig?.title||"Configuration"}</h3>
        <div class="buttons">
          <button data-close title="Close (Alt+C)">âœ•</button>
        </div>
      </div>
      <div class="config-scroll">
        <form id="config-form" autocomplete="off">
          <div id="config-content">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="foot">Hotkeys: <kbd>Alt+C</kbd> config, <kbd>Alt+P</kbd> FPS</div>
        </form>
      </div>
    `}updateOverlayContent(){if(!this.overlayEl||!this.currentConfig)return;const e=this.overlayEl.querySelector("#config-content");e&&(e.innerHTML=this.generateConfigHTML())}generateConfigHTML(){return this.currentConfig?.sections?this.currentConfig.sections.map(e=>{const t=e.fields.map(i=>this.generateFieldHTML(i)).join("");return`
        <fieldset>
          <legend>${e.title}</legend>
          ${t}
        </fieldset>
      `}).join(""):""}generateFieldHTML(e){const{type:t,name:i,label:n,value:o,min:s,max:l,step:c,options:h}=e,d=`field-${i}`;switch(t){case"range":return`
          <label>
            ${n}
            <input type="range" name="${i}" id="${d}" min="${s||0}" max="${l||100}" step="${c||1}" value="${o||50}" data-val />
          </label>
        `;case"color":return`
          <label>
            ${n}
            <input type="color" name="${i}" id="${d}" value="${o||"#00ff6a"}" />
          </label>
        `;case"checkbox":return`
          <label>
            <input type="checkbox" name="${i}" id="${d}" ${o?"checked":""} />
            ${n}
          </label>
        `;case"select":const u=h.map(p=>`<option value="${p.value}" ${p.value===o?"selected":""}>${p.label}</option>`).join("");return`
          <label>
            ${n}
            <select name="${i}" id="${d}">${u}</select>
          </label>
        `;case"number":return`
          <label>
            ${n}
            <input type="number" name="${i}" id="${d}" min="${s||0}" max="${l||100}" step="${c||1}" value="${o||0}" />
          </label>
        `;default:return""}}setupGlobalHotkeys(){document.addEventListener("keydown",e=>{e.altKey&&(e.code==="KeyP"&&(e.preventDefault(),e.stopPropagation(),this.toggleFps()),e.code==="KeyC"&&(e.preventDefault(),e.stopPropagation(),this.toggleOverlay()))},{passive:!1})}toggleOverlay(e){this.open=typeof e=="boolean"?e:!this.open,this.overlayEl&&(this.overlayEl.style.display=this.open?"flex":"none")}toggleFps(){this.fpsEnabled=!this.fpsEnabled,this.fpsEl&&(this.fpsEl.style.display=this.fpsEnabled?"block":"none")}startFpsLoop(){this.boundLoop||(this.fpsEl=document.getElementById("fps-counter")||this.createFloatingFps(),this.fpsEl.style.display="none",this.boundLoop=e=>{if(this.frames++,e-this.lastFpsSample>1e3){const t=this.frames*1e3/(e-this.lastFpsSample);this.frames=0,this.lastFpsSample=e,this.smoothFps=this.smoothFps?this.smoothFps*.7+t*.3:t,this.fpsEnabled&&(this.fpsEl.textContent="FPS: "+this.smoothFps.toFixed(0))}requestAnimationFrame(this.boundLoop)},requestAnimationFrame(this.boundLoop))}createFloatingFps(){const e=document.createElement("div");return e.id="fps-counter",e.textContent="FPS: --",e.style.position="fixed",e.style.top="58px",e.style.right="12px",e.style.zIndex="1000",e.style.font="12px Roboto, monospace",e.style.padding="4px 8px",e.style.background="rgba(0,0,0,0.4)",e.style.border="1px solid rgba(0,255,106,0.35)",e.style.borderRadius="6px",e.style.color="var(--accent)",document.body.appendChild(e),e}setupConfigForm(){if(!this.overlayEl||!this.currentConfig)return;const e=this.overlayEl.querySelector("#config-form");e&&(e.querySelectorAll("[data-bound]").forEach(t=>{t.dataset.bound=""}),e.querySelectorAll("input[type=range][data-val]").forEach(t=>{if(!t.parentElement.querySelector(".val")){const i=document.createElement("span");i.className="val",i.textContent=t.value,t.parentElement.appendChild(i)}if(!t.dataset.bound){const i=t.parentElement.querySelector(".val");t.addEventListener("input",()=>{i.textContent=t.value,this.applyChange(t.name,t.value)}),t.dataset.bound="1"}}),e.querySelectorAll("input[type=color]").forEach(t=>{t.dataset.bound||(t.addEventListener("input",()=>this.applyChange(t.name,t.value)),t.dataset.bound="1")}),e.querySelectorAll("input[type=checkbox]").forEach(t=>{t.dataset.bound||(t.addEventListener("change",()=>this.applyChange(t.name,t.checked)),t.dataset.bound="1")}),e.querySelectorAll("select").forEach(t=>{t.dataset.bound||(t.addEventListener("change",()=>this.applyChange(t.name,t.value)),t.dataset.bound="1")}),e.querySelectorAll("input[type=number]").forEach(t=>{t.dataset.bound||(t.addEventListener("input",()=>this.applyChange(t.name,parseFloat(t.value))),t.dataset.bound="1")}))}applyChange(e,t){this.currentConfig?.onChange&&this.currentConfig.onChange(e,t)}}const P=new Y;function L(r){P.init(),P.configure(r)}function y(r){P.updateConfig(r)}const _="config-style",S=`/* Generic Config Overlay (update-safe) */
#config-overlay{position:fixed;top:0;left:0;display:flex;align-items:stretch;justify-content:flex-start;pointer-events:none;z-index:1500;font:16px Roboto,system-ui,sans-serif;line-height:1.25;}
#config-overlay .config-scroll{width:360px;max-width:92vw;height:100vh;overflow:auto;background:#121212f2;border-right:1px solid rgba(0,255,106,0.4);box-shadow:8px 0 28px -6px rgba(0,0,0,0.7);padding:22px 20px 92px;pointer-events:auto;}
#config-overlay h3{margin:0;font-weight:600;letter-spacing:.85px;color:var(--accent);font-size:21px;text-shadow:0 0 10px rgba(0,255,106,.65);}
#config-overlay fieldset{border:1px solid rgba(0,255,106,0.28);border-radius:12px;margin:16px 0 26px;padding:14px 16px 16px;display:flex;flex-direction:column;gap:14px;}
#config-overlay legend{padding:0 9px;font-size:14px;letter-spacing:.75px;color:var(--accent-soft);}
#config-overlay label{display:flex;flex-direction:column;gap:6px;font-size:14px;color:var(--text-dim);}
#config-overlay input[type=range]{width:100%;}
#config-overlay .val{font-family:monospace;color:var(--accent);font-size:13px;}
#config-overlay .config-header{position:fixed;top:0;left:0;width:360px;display:flex;align-items:center;justify-content:space-between;padding:16px 20px 14px;background:linear-gradient(180deg,#141414,#121212cc);box-shadow:0 4px 12px -6px rgba(0,0,0,0.55);pointer-events:auto;}
#config-overlay .buttons button{background:#161616;border:1px solid rgba(0,255,106,0.6);color:var(--accent);cursor:pointer;font-size:15px;padding:7px 12px;border-radius:8px;line-height:1;transition:background .15s;}
#config-overlay .buttons button:hover{background:#242424;}
#config-overlay form{margin-top:70px;}
#config-overlay .foot{font-size:13px;color:var(--text-dim);margin-top:10px;opacity:.95;}
#config-overlay kbd{background:#222;border:1px solid rgba(255,255,255,0.22);border-radius:5px;padding:3px 6px;font-size:12px;margin:0 2px;box-shadow:0 0 0 1px #000;}
#config-overlay select{width:100%;padding:4px 8px;border:1px solid rgba(0,255,106,0.3);border-radius:4px;background:#161616;color:var(--text-dim);}
#config-overlay input[type=number]{width:100%;padding:4px 8px;border:1px solid rgba(0,255,106,0.3);border-radius:4px;background:#161616;color:var(--text-dim);}
@media (max-width: 680px){#config-overlay .config-scroll{width:94vw;}}`;let m=document.getElementById(_);m?m.textContent!==S&&(m.textContent=S):(m=document.createElement("style"),m.id=_,m.textContent=S,document.head.appendChild(m));class R{constructor(e,t){this.container=e,this.config=t,this.enabled=!1}init(){}setEnabled(e){this.enabled=e}update(e){}triggerPulse(e,t,i,n,o,s){}dispose(){}getConfigOptions(){return[]}updateConfig(e){Object.assign(this.config,e)}}class f{static sharedTemplates=new Map;constructor(e,t,i,n,o,s,l=0,c={}){this.startX=e,this.startY=t,this.endX=i,this.endY=n,this.column=o,this.row=s,this.bundleCenterX=l,this.config=c||{};const h=this.config||{},d=`col_${o}_row_${s}_strength_${h.wireCurveStrength||25}`;f.sharedTemplates.has(d)?this.reuseSharedTemplate(d):(this.computeNewTemplate(),f.sharedTemplates.set(d,{relativeControlX:this.relativeControlX,relativeControlY:this.relativeControlY,curvePoints:this.curvePoints})),this.computeAbsoluteCoordinates()}reuseSharedTemplate(e){const t=f.sharedTemplates.get(e);this.relativeControlX=t.relativeControlX,this.relativeControlY=t.relativeControlY,this.curvePoints=t.curvePoints}computeNewTemplate(){this.relativeControlX=this.calculateRelativeControlX(),this.relativeControlY=this.calculateRelativeControlY(),this.precomputeRelativeCurvePoints()}computeAbsoluteCoordinates(){const e=(this.startX+this.endX)/2,t=(this.startY+this.endY)/2;this.controlX=e+this.relativeControlX,this.controlY=t+this.relativeControlY,this.absoluteCurvePoints=this.curvePoints.map(i=>({x:e+i.x,y:t+i.y,t:i.t}))}calculateRelativeControlX(){const e=this.config.wireCurveStrength||25;let t=0;this.column===0?t=-e*1.2:this.column===1?t=-e*.6:this.column===3?t=e*.6:this.column===4&&(t=e*1.2);const i=this.endX-this.startX,n=this.endY-this.startY,o=Math.sqrt(i*i+n*n);return n/o*t}calculateRelativeControlY(){const e=this.config.wireCurveStrength||25;let t=0;this.column===0?t=-e*1.2:this.column===1?t=-e*.6:this.column===3?t=e*.6:this.column===4&&(t=e*1.2);const i=this.endX-this.startX,n=this.endY-this.startY,o=Math.sqrt(i*i+n*n);return-i/o*t}precomputeRelativeCurvePoints(){this.curvePoints=[];const e=12;for(let t=0;t<=e;t++){const i=t/e,n=this.startX-(this.startX+this.endX)/2,o=this.startY-(this.startY+this.endY)/2,s=this.endX-(this.startX+this.endX)/2,l=this.endY-(this.startY+this.endY)/2,c=this.relativeControlX,h=this.relativeControlY,d=(1-i)*(1-i)*n+2*(1-i)*i*c+i*i*s,u=(1-i)*(1-i)*o+2*(1-i)*i*h+i*i*l;this.curvePoints.push({x:d,y:u,t:i})}}getPointAtProgress(e){const t=Math.floor(e*(this.absoluteCurvePoints.length-1)),i=Math.min(t+1,this.absoluteCurvePoints.length-1),n=this.absoluteCurvePoints[t],o=this.absoluteCurvePoints[i],s=e*(this.absoluteCurvePoints.length-1)-t;return{x:n.x+(o.x-n.x)*s,y:n.y+(o.y-n.y)*s}}drawInactive(e){const t=e.createLinearGradient(this.startX,this.startY,this.endX,this.endY);t.addColorStop(0,"rgba(68,68,68,0.4)"),t.addColorStop(.6,"rgba(68,68,68,0.4)"),t.addColorStop(1,"rgba(68,68,68,0)"),e.strokeStyle=t,e.lineWidth=this.config.wireLineThickness||1.5,e.globalAlpha=1,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(this.startX,this.startY),e.quadraticCurveTo(this.controlX,this.controlY,this.endX,this.endY),e.stroke()}}class k{constructor(e,t,i,n,o=0,s=0,l=0,c=0,h){this.template=new f(e,t,i,n,o,s,l,h),this.isActive=!1,this.pulseProgress=0,this.pulseSpeed=h.wirePulseSpeed||2.2,this.lastPulseTime=0,this.bundleIndex=c,this.column=o,this.row=s,this.uniqueId=`bundle_${c}_col_${o}_row_${s}`}triggerPulse(){this.isActive=!0,this.pulseProgress=0,this.lastPulseTime=performance.now()}update(e){return this.isActive&&(this.pulseProgress+=this.pulseSpeed*(e-this.lastPulseTime)/1e3,this.pulseProgress>=1&&(this.isActive=!1,this.pulseProgress=0)),this.lastPulseTime=e,this.isActive&&this.pulseProgress>0}drawInactive(e){this.template.drawInactive(e)}drawPulse(e,t){if(t<.02||t>.99)return;const i=5,n=.15,o=(1-t)*1.5;if(!(o<=.005)){e.fillStyle="#00ff6a",e.shadowColor="#00ff6a";for(let s=0;s<i;s++){const l=t-s*n/i;if(l<0)continue;const c=o*(1-s/i)*(1-l);if(c<=.005)continue;const h=this.template.getPointAtProgress(l);e.globalAlpha=c,e.shadowBlur=8+s*.8,e.beginPath(),e.arc(h.x,h.y,2-s*.12,0,Math.PI*2),e.fill(),s===0&&(e.globalAlpha=Math.min(1,c*1.4),e.shadowBlur=8,e.beginPath(),e.arc(h.x,h.y,1.1,0,Math.PI*2),e.fill())}}}}class M{constructor(e,t){this.container=e,this.config=t,this.canvas=null,this.ctx=null,this.lines=new Map,this.enabled=!1,this.lastTime=0,this.lastInactiveDraw=0,this.inactiveCanvas=null,this.inactiveCtx=null,this.inactiveDirty=!0,this.activePulses=new Map,this.init()}init(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex="10",this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.ctx||console.error("WireAnimator: Failed to get 2D context!"),this.inactiveCanvas=document.createElement("canvas"),this.inactiveCtx=this.inactiveCanvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.inactiveCanvas.width=this.canvas.width,this.inactiveCanvas.height=this.canvas.height,this.ctx&&(this.ctx.fillStyle="rgba(255, 0, 0, 0.1)",this.ctx.fillRect(10,10,50,50)),this.inactiveDirty=!0)}updateSquarePosition(e,t,i,n,o,s=0,l=0,c=0,h=0){if(!this.lines.has(e))this.lines.set(e,new k(t,i,n,o,s,l,c,h,this.config)),this.inactiveDirty=!0;else{const u=this.lines.get(e);(u.template.startX!==t||u.template.startY!==i||u.template.endX!==n||u.template.endY!==o)&&(u.template.startX=t,u.template.startY=i,u.template.endX=n,u.template.endY=o,u.template.bundleCenterX=c,u.template.computeAbsoluteCoordinates(),this.inactiveDirty=!0)}}triggerPulse(e){if(!this.enabled||!this.lines.has(e))return;const t=this.lines.get(e);t.triggerPulse(),this.activePulses.set(t.uniqueId,t)}update(e){if(this.enabled&&(this.lastTime&&(e-this.lastTime)/1e3,this.lastTime=e,this.inactiveDirty&&(this.drawInactiveLinesToOffscreen(),this.inactiveDirty=!1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.inactiveCanvas,0,0),this.activePulses.size>0)){this.ctx.save();const t=[];for(const[i,n]of this.activePulses)n.update(e)?n.drawPulse(this.ctx,n.pulseProgress):t.push(i);t.forEach(i=>this.activePulses.delete(i)),this.ctx.restore()}}drawInactiveLinesToOffscreen(){this.inactiveCtx.clearRect(0,0,this.inactiveCanvas.width,this.inactiveCanvas.height),this.inactiveCtx.lineWidth=this.config.wireLineThickness||1.5,this.inactiveCtx.globalAlpha=1,this.inactiveCtx.lineCap="round",this.inactiveCtx.lineJoin="round",this.lines.forEach(e=>{const t=this.inactiveCtx.createLinearGradient(e.template.startX,e.template.startY,e.template.endX,e.template.endY);t.addColorStop(0,"rgba(68,68,68,0.4)"),t.addColorStop(.6,"rgba(68,68,68,0.4)"),t.addColorStop(1,"rgba(68,68,68,0)"),this.inactiveCtx.strokeStyle=t,this.inactiveCtx.beginPath(),this.inactiveCtx.moveTo(e.template.startX,e.template.startY),this.inactiveCtx.quadraticCurveTo(e.template.controlX,e.template.controlY,e.template.endX,e.template.endY),this.inactiveCtx.stroke()})}drawInactiveLines(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.inactiveCanvas,0,0)}setEnabled(e){this.enabled=e,e?this.drawInactiveLines():this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}initializeAllLines(e){if(!e)return;this.lines.clear(),e.getBundles().forEach((i,n)=>{i.getAllSquares().forEach(s=>{const l=e.config.squareSize,c=e.config.spacing;e.config.counterHeight;const d=5*l+4*c,u=i.position.x-d/2+l/2,p=2*l+c,C=i.position.y+p/2-l/2,b=u+s.column*(l+c),E=C-s.row*(l+c),A={x:b,y:E},g=e.worldToScreen(A),v=this.getBundleCounterPosition(i,n,e,s.column),T=i.position.x,x=`bundle_${n}_square_${s.column}_${s.row}`;this.updateSquarePosition(x,g.x,g.y,v.x,v.y,s.column,s.row,T,n)})}),this.drawInactiveLines()}getBundleCounterPosition(e,t,i,n=2){const o=i.config.spacing,s=i.config.counterHeight,l=i.config.squareSize,c=2*l+o,h=s*l+(s-1)*o,d=e.position.y-c/2-o-h/2,u={x:e.position.x,y:d};return i.worldToScreen(u)}dispose(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.lines.clear(),this.activePulses.clear(),f.sharedTemplates.clear()}}class N extends R{constructor(e,t){super(e,t),this.pulseLineSystem=null}init(){this.pulseLineSystem=new M(this.container,this.config),this.pulseLineSystem.setEnabled(!1)}setEnabled(e){super.setEnabled(e),this.pulseLineSystem&&this.pulseLineSystem.setEnabled(e)}update(e){this.pulseLineSystem&&this.pulseLineSystem.update(e)}triggerPulse(e,t,i,n,o,s){!this.pulseLineSystem||!this.enabled||(this.pulseLineSystem.updateSquarePosition(e,t.x,t.y,i.x,i.y,n,o,0,s),this.pulseLineSystem.triggerPulse(e))}initializeAllLines(e){this.pulseLineSystem&&this.pulseLineSystem.initializeAllLines(e)}dispose(){this.pulseLineSystem&&this.pulseLineSystem.dispose()}getConfigOptions(){return[{type:"range",name:"wireLineThickness",label:"Line Thickness",value:this.config.wireLineThickness||1.5,min:.5,max:5,step:.1},{type:"range",name:"wireCurveStrength",label:"Curve Strength",value:this.config.wireCurveStrength||25,min:5,max:50,step:1},{type:"range",name:"wirePulseSpeed",label:"Pulse Speed",value:this.config.wirePulseSpeed||2.2,min:.5,max:5,step:.1}]}updateConfig(e){super.updateConfig(e),this.pulseLineSystem&&(this.pulseLineSystem.config=this.config,this.pulseLineSystem.inactiveDirty!==void 0&&(this.pulseLineSystem.inactiveDirty=!0))}}class H{constructor(e,t,i,n,o){this.x=e,this.y=t,this.targetX=i,this.targetY=n,this.color=o.particleColor||"#23CD3C",this.size=o.particleSize||1.44,this.glow=o.particleGlow||.5,this.travelTime=o.particleTravelTime||.5,this.startTime=performance.now()/1e3,this.elapsed=0;const s=i-e,l=n-t;this.distance=Math.sqrt(s*s+l*l),this.distance===0?(this.speed=0,this.dirX=0,this.dirY=0):(this.speed=this.distance/this.travelTime,this.dirX=s/this.distance,this.dirY=l/this.distance),this.life=1,this.maxLife=1,this.alpha=1}update(e){if(this.elapsed+=e,this.elapsed<this.travelTime){const i=this.speed*e;this.x+=this.dirX*i,this.y+=this.dirY*i}else this.x=this.targetX,this.y=this.targetY;const t=Math.min(this.elapsed/this.travelTime,1);return this.alpha=1-t,this.alpha>0}draw(e){this.alpha<=0||(e.save(),e.globalAlpha=this.alpha,this.glow>0&&(e.shadowColor=this.color,e.shadowBlur=this.size*this.glow*4,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.size,0,Math.PI*2),e.fill(),e.restore())}}class z{constructor(e,t){this.container=e,this.config=t,this.canvas=null,this.ctx=null,this.particles=[],this.particlePool=[],this.enabled=!1,this.maxParticles=1e4,this.lastTime=0,this.lastUpdateTime=0,this.init()}init(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex="10",this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.ctx||console.error("ParticleAnimator: Failed to get 2D context!"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx&&(this.ctx.fillStyle="rgba(0, 255, 0, 0.1)",this.ctx.fillRect(70,10,50,50)))}spawnParticle(e,t,i,n){if(!this.enabled||this.particles.length>=this.maxParticles)return;const o=this.config.particleTravelTime||.5;let s;if(this.particlePool.length>0){s=this.particlePool.pop(),s.x=e,s.y=t,s.targetX=i,s.targetY=n,s.color=this.config.particleColor||"#23CD3C",s.size=this.config.particleSize||1.44,s.glow=this.config.particleGlow||.5,s.travelTime=o,s.startTime=performance.now()/1e3,s.elapsed=0;const l=i-e,c=n-t;s.distance=Math.sqrt(l*l+c*c),s.distance===0?(s.speed=0,s.dirX=0,s.dirY=0):(s.speed=s.distance/o,s.dirX=l/s.distance,s.dirY=c/s.distance),s.life=1,s.maxLife=1,s.alpha=1}else{s=new H(e,t,i,n,this.config),s.travelTime=o;const l=i-e,c=n-t;s.distance=Math.sqrt(l*l+c*c),s.distance===0?(s.speed=0,s.dirX=0,s.dirY=0):(s.speed=s.distance/o,s.dirX=l/s.distance,s.dirY=c/s.distance)}this.particles.push(s)}update(e){if(!this.enabled)return;const t=this.lastTime?(e-this.lastTime)/1e3:0;if(this.lastTime=e,this.lastUpdateTime&&e-this.lastUpdateTime<16)return;this.lastUpdateTime=e;const i=[];this.particles.forEach(n=>{n.update(t)?i.push(n):this.particlePool.push(n)}),this.particles=i,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(n=>n.draw(this.ctx))}setEnabled(e){this.enabled=e,e||(this.particles.forEach(t=>this.particlePool.push(t)),this.particles=[],this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}dispose(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.particles.forEach(e=>this.particlePool.push(e)),this.particles=[],this.particlePool=[]}}class X extends R{constructor(e,t){super(e,t),this.particleSystem=null}init(){this.particleSystem=new z(this.container,this.config)}setEnabled(e){super.setEnabled(e),this.particleSystem&&this.particleSystem.setEnabled(e)}update(e){this.particleSystem&&this.particleSystem.update(e)}triggerPulse(e,t,i,n,o,s){!this.particleSystem||!this.enabled||this.particleSystem.spawnParticle(t.x,t.y,i.x,i.y)}dispose(){this.particleSystem&&this.particleSystem.dispose()}getConfigOptions(){return[{type:"range",name:"particleSize",label:"Particle Size",value:this.config.particleSize||1.44,min:.5,max:5,step:.1},{type:"range",name:"particleGlow",label:"Particle Glow",value:this.config.particleGlow||.5,min:0,max:2,step:.1},{type:"range",name:"particleTravelTime",label:"Travel Time (s)",value:this.config.particleTravelTime||.5,min:.1,max:2,step:.1},{type:"color",name:"particleColor",label:"Particle Color",value:this.config.particleColor||"#23CD3C"}]}updateConfig(e){super.updateConfig(e),this.particleSystem&&(this.particleSystem.config=this.config)}}function F(r){return r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}const a={BUNDLE_SPACING:.65,PAGE_PERIMETER:2.5,COUNTER_HEIGHT:2,BUNDLE_COUNT:77,SQUARE_SIZE:58,SPACING:1,HEART_RATE_1:85,HEART_RATE_2:26,RATE_VARIATION:.35,FADE_RATE:1,COUNTER_DELAY:.5,ACTIVITY_LEVELS:{a1:1,a:.8,b:.65,c:.4,d:.3,e:.2,f:.05},TEXT_SCALE_FACTOR:1.2,TEXT_GLOW:.6,TEXT_COLOR:"#23CD3C",SHOW_COUNTERS:!1,ANIMATION_TYPE:"wire",wireLineThickness:1.5,wireCurveStrength:25,wirePulseSpeed:2.2,particleSize:1.44,particleGlow:.5,particleTravelTime:.5,particleColor:"#23CD3C"};class D{constructor(){this.renderer=null,this.time=0,this.fpsCounter=0,this.fpsLastTime=performance.now(),this.fpsFrames=0,this.textGlow=.6,this.countersVisible=!1,this.updateTimeout=null,this.activeAnimator=null,this.lastPulseCounts=new Map,this.init()}init(){const e=document.getElementById("container");if(!e)throw new Error("Container element not found");this.container=e,this.renderer=new O(e,{mode:"multi",bundleCount:a.BUNDLE_COUNT,bundleSpacing:a.BUNDLE_SPACING,pagePerimeter:a.PAGE_PERIMETER,counterHeight:a.COUNTER_HEIGHT,heartRate1:a.HEART_RATE_1,heartRate2:a.HEART_RATE_2,squareSize:a.SQUARE_SIZE,spacing:a.SPACING,activityLevels:a.ACTIVITY_LEVELS,rateVariation:a.RATE_VARIATION,fadeRate:a.FADE_RATE,counterDelay:0,showCounters:a.SHOW_COUNTERS,renderWidth:window.innerWidth,renderHeight:window.innerHeight}),this.setupEventListeners(),this.setupLegendUpdates(),this.setupFPSCounter(),this.setAnimationType(a.ANIMATION_TYPE),this.countersVisible=a.SHOW_COUNTERS,this.renderer.setShowCounters(this.countersVisible),this.renderer.animate(),this.updateText({scale:a.TEXT_SCALE_FACTOR,glow:a.TEXT_GLOW,color:a.TEXT_COLOR});const t=document.getElementById("data-counter");if(t){const n=20*a.TEXT_SCALE_FACTOR;t.style.fontSize=n+"px"}}setAnimationType(e,t=!1){if(this.activeAnimator&&(this.activeAnimator.dispose(),this.activeAnimator=null),a.ANIMATION_TYPE=e,e==="wire")this.activeAnimator=new N(this.container,a);else if(e==="particle")this.activeAnimator=new X(this.container,a);else{this.activeAnimator=null;return}this.activeAnimator.init(),this.activeAnimator.setEnabled(t);const i=t?a.COUNTER_DELAY:0;this.renderer.setCounterDelay(i),t&&e==="wire"&&this.activeAnimator.initializeAllLines&&this.activeAnimator.initializeAllLines(this.renderer),this.updateConfigPanel()}getAnimationConfigOptions(){return!this.activeAnimator||!this.activeAnimator.getConfigOptions?[]:this.activeAnimator.getConfigOptions()}updateAnimationConfig(e){Object.assign(a,e),this.activeAnimator&&this.activeAnimator.updateConfig&&this.activeAnimator.updateConfig(a)}updateConfigPanel(){if(typeof y!="function")return;const e=this.getAnimationConfigOptions(),t=[{type:"checkbox",name:"countersVisible",label:"Show Counters",value:a.SHOW_COUNTERS},{type:"select",name:"animationType",label:"Animation Type",value:a.ANIMATION_TYPE,options:[{value:"none",label:"None"},{value:"wire",label:"Wire (Curved Lines)"},{value:"particle",label:"Particle (Straight)"}]},{type:"checkbox",name:"animationEnabled",label:"Enable Animation",value:this.activeAnimator?this.activeAnimator.enabled:!1},...e,{type:"button",name:"resetAllPulses",label:"Reset All Pulse Counts"}];y({sections:[{title:"Bundle Layout",fields:[{type:"range",name:"bundleSpacing",label:"Bundle Spacing (squares)",value:a.BUNDLE_SPACING,min:.1,max:2,step:.05},{type:"range",name:"pagePerimeter",label:"Page Perimeter (squares)",value:a.PAGE_PERIMETER,min:0,max:10,step:.5},{type:"range",name:"counterHeight",label:"Counter Height (squares)",value:a.COUNTER_HEIGHT,min:1,max:5,step:.1}]},{title:"Pulse Rates",fields:[{type:"range",name:"heartRate1",label:"Primary Rate (BPM)",value:a.HEART_RATE_1,min:30,max:180,step:1},{type:"range",name:"heartRate2",label:"Secondary Rate (BPM)",value:a.HEART_RATE_2,min:10,max:100,step:1},{type:"range",name:"rateVariation",label:"Rate Variation (%)",value:Math.round(a.RATE_VARIATION*100),min:0,max:100,step:1},{type:"range",name:"fadeRate",label:"Fade Rate",value:a.FADE_RATE,min:.1,max:3,step:.1}]},{title:"Activity Levels",fields:[{type:"range",name:"activityA1",label:"A1 Activity",value:Math.round(a.ACTIVITY_LEVELS.a1*100),min:0,max:100,step:5},{type:"range",name:"activityA",label:"A Activity",value:Math.round(a.ACTIVITY_LEVELS.a*100),min:0,max:100,step:5},{type:"range",name:"activityB",label:"B Activity",value:Math.round(a.ACTIVITY_LEVELS.b*100),min:0,max:100,step:5},{type:"range",name:"activityC",label:"C Activity",value:Math.round(a.ACTIVITY_LEVELS.c*100),min:0,max:100,step:5},{type:"range",name:"activityD",label:"D Activity",value:Math.round(a.ACTIVITY_LEVELS.d*100),min:0,max:100,step:5},{type:"range",name:"activityE",label:"E Activity",value:Math.round(a.ACTIVITY_LEVELS.e*100),min:0,max:100,step:5},{type:"range",name:"activityF",label:"F Activity",value:Math.round(a.ACTIVITY_LEVELS.f*100),min:0,max:100,step:5}]},{title:"Visual Effects",fields:[{type:"range",name:"textScale",label:"Text Scale Factor",value:a.TEXT_SCALE_FACTOR,min:.5,max:2,step:.1},{type:"range",name:"textGlow",label:"Text Glow",value:a.TEXT_GLOW,min:0,max:1,step:.05},{type:"color",name:"textColor",label:"Text Color",value:a.TEXT_COLOR}]},{title:"Animation Settings",fields:t}]})}setupEventListeners(){window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.renderer&&this.renderer.updateDimensions(window.innerWidth,window.innerHeight),this.activeAnimator&&(this.activeAnimator.setEnabled(!1),this.renderer.setCounterDelay(0))}setupLegendUpdates(){let e=0,t=0,i=0;const o=1e3/30,s=l=>{if(l-t>=50){let c=0;if(this.renderer)try{c=this.renderer.getTotalPulseCount()}catch{}e+=(c-e)*.1;const h=document.getElementById("data-counter");h&&(h.textContent="Total Pulses: "+F(Math.round(e))),t=l}l-i>=o?(this.activeAnimator&&(this.activeAnimator.update(l),this.checkForNewPulses()),i=l):this.activeAnimator&&this.activeAnimator.update(l),requestAnimationFrame(s)};requestAnimationFrame(s)}checkForNewPulses(){if(!this.renderer||!this.activeAnimator||!this.activeAnimator.enabled)return;this.renderer.getBundles().forEach((t,i)=>{const n=t.getPulseCount(),o=this.lastPulseCounts.get(i)||0;n>o&&t.getAllSquares().forEach(l=>{const c=l.getPulseCount(),h=this.lastPulseCounts.get(`square_${i}_${l.column}_${l.row}`)||0;if(c>h){const d=this.renderer.config.squareSize,u=this.renderer.config.spacing;this.renderer.config.counterHeight;const C=5*d+4*u,b=t.position.x-C/2+d/2,E=2*d+u,A=t.position.y+E/2-d/2,g=b+l.column*(d+u),v=A-l.row*(d+u),T={x:g,y:v},x=this.renderer.worldToScreen(T),w=this.getBundleCounterPosition(t,i);if(w){const I=`bundle_${i}_square_${l.column}_${l.row}`;this.activeAnimator.triggerPulse(I,x,w,l.column,l.row,i)}}this.lastPulseCounts.set(`square_${i}_${l.column}_${l.row}`,c)}),this.lastPulseCounts.set(i,n)})}getBundleCounterPosition(e,t){const i=this.renderer.config.spacing,n=this.renderer.config.counterHeight,o=this.renderer.config.squareSize,s=2*o+i,l=n*o+(n-1)*i,c=e.position.y-s/2-i-l/2,h={x:e.position.x,y:c};return this.renderer.worldToScreen(h)}setupFPSCounter(){document.addEventListener("keydown",e=>{(e.key==="t"||e.key==="T")&&(e.preventDefault(),this.toggleCounters()),(e.key==="r"||e.key==="R")&&(e.preventDefault(),this.resetAllPulses()),(e.key==="p"||e.key==="P")&&(e.altKey||(e.preventDefault(),this.toggleAnimation())),(e.key==="t"||e.key==="T")&&e.altKey&&(e.preventDefault(),this.testPulse())})}toggleCounters(){this.countersVisible=!this.countersVisible,this.renderer&&this.renderer.setShowCounters(this.countersVisible),a.SHOW_COUNTERS=this.countersVisible,typeof y=="function"&&y({sections:[{title:"Bundle Layout",fields:[{type:"range",name:"bundleSpacing",label:"Bundle Spacing (squares)",value:a.BUNDLE_SPACING,min:.1,max:2,step:.05},{type:"range",name:"pagePerimeter",label:"Page Perimeter (squares)",value:a.PAGE_PERIMETER,min:0,max:10,step:.5},{type:"range",name:"counterHeight",label:"Counter Height (squares)",value:a.COUNTER_HEIGHT,min:1,max:5,step:.1}]},{title:"Pulse Rates",fields:[{type:"range",name:"heartRate1",label:"Primary Rate (BPM)",value:a.HEART_RATE_1,min:30,max:180,step:1},{type:"range",name:"heartRate2",label:"Secondary Rate (BPM)",value:a.HEART_RATE_2,min:10,max:100,step:1},{type:"range",name:"rateVariation",label:"Rate Variation (%)",value:Math.round(a.RATE_VARIATION*100),min:0,max:100,step:1},{type:"range",name:"fadeRate",label:"Fade Rate",value:a.FADE_RATE,min:.1,max:3,step:.1}]},{title:"Activity Levels",fields:[{type:"range",name:"activityA1",label:"A1 Activity",value:Math.round(a.ACTIVITY_LEVELS.a1*100),min:0,max:100,step:5},{type:"range",name:"activityA",label:"A Activity",value:Math.round(a.ACTIVITY_LEVELS.a*100),min:0,max:100,step:5},{type:"range",name:"activityB",label:"B Activity",value:Math.round(a.ACTIVITY_LEVELS.b*100),min:0,max:100,step:5},{type:"range",name:"activityC",label:"C Activity",value:Math.round(a.ACTIVITY_LEVELS.c*100),min:0,max:100,step:5},{type:"range",name:"activityD",label:"D Activity",value:Math.round(a.ACTIVITY_LEVELS.d*100),min:0,max:100,step:5},{type:"range",name:"activityE",label:"E Activity",value:Math.round(a.ACTIVITY_LEVELS.e*100),min:0,max:100,step:5},{type:"range",name:"activityF",label:"F Activity",value:Math.round(a.ACTIVITY_LEVELS.f*100),min:0,max:100,step:5}]},{title:"Visual Effects",fields:[{type:"range",name:"textScale",label:"Text Scale Factor",value:a.TEXT_SCALE_FACTOR,min:.5,max:2,step:.1},{type:"range",name:"textGlow",label:"Text Glow",value:a.TEXT_GLOW,min:0,max:1,step:.05},{type:"color",name:"textColor",label:"Text Color",value:a.TEXT_COLOR}]},{title:"Controls",fields:[{type:"checkbox",name:"countersVisible",label:"Show Counters",value:a.SHOW_COUNTERS},{type:"select",name:"animationType",label:"Animation Type",value:a.ANIMATION_TYPE,options:[{value:"none",label:"None"},{value:"wire",label:"Wire (Curved Lines)"},{value:"particle",label:"Particle (Straight)"}]},{type:"checkbox",name:"animationEnabled",label:"Enable Animation",value:this.activeAnimator?this.activeAnimator.enabled:!1},{type:"button",name:"resetAllPulses",label:"Reset All Pulse Counts"}]}]})}resetAllPulses(){this.renderer&&this.renderer.getBundles().forEach(e=>e.resetPulseCount())}toggleAnimation(){if(!this.activeAnimator)if(a.ANIMATION_TYPE!=="none"){this.setAnimationType(a.ANIMATION_TYPE,!0);return}else return;const e=!this.activeAnimator.enabled;this.activeAnimator.setEnabled(e),e&&a.ANIMATION_TYPE==="wire"&&this.activeAnimator.initializeAllLines&&this.activeAnimator.initializeAllLines(this.renderer);const t=e?a.COUNTER_DELAY:0;this.renderer.setCounterDelay(t),this.updateConfigPanel()}setBundleSpacing(e){this.renderer&&(a.BUNDLE_SPACING=Math.max(.1,Math.min(5,e)),this.renderer.setBundleSpacing(a.BUNDLE_SPACING))}setPagePerimeter(e){this.renderer&&(a.PAGE_PERIMETER=Math.max(0,Math.min(20,e)),this.renderer.setPagePerimeter(a.PAGE_PERIMETER))}setCounterHeight(e){this.renderer&&(a.COUNTER_HEIGHT=Math.max(.5,Math.min(10,e)),this.renderer.setCounterHeight(a.COUNTER_HEIGHT))}setCounterDelay(e){this.renderer&&(a.COUNTER_DELAY=Math.max(0,Math.min(2,e)),this.renderer.setCounterDelay(a.COUNTER_DELAY))}setParticleSize(e){a.PARTICLE_SIZE=Math.max(.5,Math.min(3,e))}setParticleGlow(e){a.PARTICLE_GLOW=Math.max(0,Math.min(1,e))}updateText({glow:e,scale:t,color:i}){if(!this.renderer)return;const n={};if(typeof e=="number"&&(this.textGlow=e,n.glow=e*24),typeof t=="number"){const s=14*t;n.size=s}i&&(n.color=i),Object.keys(n).length>0&&this.renderer.updateText(n)}setHeartRate1(e){this.renderer&&this.renderer.setHeartRate1(e)}setHeartRate2(e){this.renderer&&this.renderer.setHeartRate2(e)}setActivityLevels(e){this.renderer&&this.renderer.setActivityLevels(e)}testPulse(){if(this.renderer){const n=this.renderer.getBundles();if(n.length>0){const s=n[0].getAllSquares();s.length>0&&s[0]}}if(this.activeAnimator,!this.activeAnimator||!this.activeAnimator.enabled)return;const e={x:window.innerWidth/2,y:window.innerHeight/2},t={x:window.innerWidth/2,y:window.innerHeight/4};this.activeAnimator.triggerPulse("test_square",e,t,2,0,0);const i=document.createElement("div");i.style.position="absolute",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width="10px",i.style.height="10px",i.style.background="red",i.style.borderRadius="50%",i.style.zIndex="1000",document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},1e3)}}document.addEventListener("DOMContentLoaded",()=>{try{const r=new D;window.signalMultiInstance=r,typeof L=="function"&&L({onChange:(e,t)=>{r.updateTimeout&&clearTimeout(r.updateTimeout),r.updateTimeout=setTimeout(()=>{try{if(!r.renderer||!r.renderer.isValidState)return;switch(e){case"bundleSpacing":r.setBundleSpacing(t);break;case"pagePerimeter":r.setPagePerimeter(t);break;case"counterHeight":r.setCounterHeight(t);break;case"counterDelay":r.renderer.setCounterDelay(+t);break;case"heartRate1":r.renderer.setHeartRate1(+t);break;case"heartRate2":r.renderer.setHeartRate2(+t);break;case"rateVariation":r.renderer.updateConfig({rateVariation:+t/100});break;case"fadeRate":r.renderer.setFadeRate(+t);break;case"activityA1":r.renderer.setActivityLevels({a1:+t/100});break;case"activityA":r.renderer.setActivityLevels({a:+t/100});break;case"activityB":r.renderer.setActivityLevels({b:+t/100});break;case"activityC":r.renderer.setActivityLevels({c:+t/100});break;case"activityD":r.renderer.setActivityLevels({d:+t/100});break;case"activityE":r.renderer.setActivityLevels({e:+t/100});break;case"activityF":r.renderer.setActivityLevels({f:+t/100});break;case"textScale":a.TEXT_SCALE_FACTOR=+t,r.updateText({scale:+t});const i=document.getElementById("data-counter");if(i){const s=20*+t;i.style.fontSize=s+"px"}break;case"textGlow":a.TEXT_GLOW=t,r.updateText({glow:t});break;case"textColor":a.TEXT_COLOR=t,r.updateText({color:t});break;case"countersVisible":r.countersVisible=t,r.renderer.setShowCounters(t);break;case"animationType":const n=r.activeAnimator?r.activeAnimator.enabled:!1;r.setAnimationType(t,n);break;case"animationEnabled":if(r.activeAnimator){r.activeAnimator.setEnabled(t);const o=t?a.COUNTER_DELAY:0;r.renderer.setCounterDelay(o),t&&a.ANIMATION_TYPE==="wire"&&r.activeAnimator.initializeAllLines&&r.activeAnimator.initializeAllLines(r.renderer)}break;case"wireLineThickness":r.updateAnimationConfig({wireLineThickness:+t});break;case"wireCurveStrength":r.updateAnimationConfig({wireCurveStrength:+t});break;case"wirePulseSpeed":r.updateAnimationConfig({wirePulseSpeed:+t});break;case"particleSize":r.updateAnimationConfig({particleSize:+t});break;case"particleGlow":r.updateAnimationConfig({particleGlow:+t});break;case"particleTravelTime":r.updateAnimationConfig({particleTravelTime:+t});break;case"particleColor":r.updateAnimationConfig({particleColor:t});break;case"resetAllPulses":r.renderer.getBundles().forEach(o=>o.resetPulseCount());break}}catch{}},100)}})}catch(r){V(r)}});function V(r){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 0, 0, 0.9)",color:"white",padding:"20px",borderRadius:"10px",fontFamily:"monospace",maxWidth:"80vw",maxHeight:"80vh",overflow:"auto"}),e.innerHTML="<h2>Initialization Error</h2><pre>"+r.message+"</pre><pre>"+r.stack+"</pre>",document.body.appendChild(e)}
