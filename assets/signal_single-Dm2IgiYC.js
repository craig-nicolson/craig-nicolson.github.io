import{r as D,c as j}from"./overlayControls-D9GsMX9d.js";/* empty css              */import{S as W}from"./signalBatchRenderer-BId8LGvp.js";import{h as O,d as $,e as q,M as N,B as _}from"./color-t7R1qBCU.js";import"./signalSquare-Bn1rA2Su.js";const n={"Signal Fade Rate":{value:1.2,type:"range",min:.1,max:3,step:.1,label:"Signal Fade Rate",section:"Signal Display"},"ECG Trace Width":{value:4,type:"range",min:.5,max:16,step:.1,label:"Trace Width",section:"ECG Trace"},"ECG Head Size":{value:10,type:"range",min:2,max:28,step:.5,label:"Head Dot Size",section:"ECG Trace"},"ECG Trail Life":{value:65,type:"range",min:5,max:200,step:1,label:"Trail Life (%)",section:"ECG Trace"},"ECG Trace Color":{value:"#00ff6a",type:"color",label:"Trace Color",section:"ECG Trace"},"ECG Grid Size":{value:100,type:"range",min:20,max:160,step:2,label:"Grid Size",section:"ECG Grid"},"ECG Show Outer Box":{value:!0,type:"checkbox",label:"Show Outer Box",section:"ECG Grid"},"ECG Show Grid Lines":{value:!0,type:"checkbox",label:"Show Grid Lines",section:"ECG Grid"},"Internal: ECG Sample Resolution":3200,"Internal: ECG Viewport Horizontal Padding":.02,"Internal: ECG Viewport Vertical Padding":.02,"Internal: ECG Heart Rate Drift":!1,"Internal: ECG Show Grid":!0,"Internal: ECG Grid Color":"#00ff6a","Internal: ECG Grid Color Major":"#00ff6a","Internal: ECG Grid Color Panel":"#00ff6a","Internal: ECG Show Grid Background":!0,"Internal: ECG Grid Gap Percent":0,"Internal: Signal Secondary Heart Rate":26,"Internal: Signal Mode":"single","Internal: Signal Rate 2 BPM":26,"Internal: Initial Heart Rate":62,"Internal: Signal A Offsets":[.1,.2,.3,.4],"Internal: Signal B Offset":50,"Internal: Signal CF Offsets":[.15,.3,.45],"Internal: Signal CF Individual Offsets":[150,300,450]};D("config",n,{onChange:(e,t,i)=>{if(e==="Signal Fade Rate"){a&&a.setFadeRate(t);return}if(["ECG Trace Width","ECG Head Size","ECG Trail Life","ECG Overlap","ECG Trace Color","ECG Grid Size","ECG Show Outer Box","ECG Show Grid Lines"].includes(e)){if(!r)return;const o={};e==="ECG Trace Width"?o.lineWidth=t:e==="ECG Head Size"?o.headDotRadius=t:e==="ECG Trail Life"?o.trailLifePercent=t:e==="ECG Trace Color"?(o.colorCore=O(t,.95),r._colorCore=new Float32Array(r.cfg.colorCore)):(e==="ECG Grid Size"||e==="ECG Show Outer Box"||e==="ECG Show Grid Lines")&&m&&m(),Object.keys(o).length>0&&r.updateConfig(o);return}}});function J(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}const G=document.getElementById("single-container"),b=document.getElementById("single-pulses"),z=document.getElementById("ecg-grid-canvas"),C=document.getElementById("ecg-trace-canvas"),h=document.getElementById("ecg-bpm"),H=document.getElementById("ecg-beats"),d=document.getElementById("ecg-hr"),p=document.getElementById("ecg-val-hr");let a=null,l={a1:!0,a:!1,b:!1,c:!1,d:!1,e:!1},c={a1:0,a:0,b:0,c:0,d:0,e:0},r=null,g=null,m=null;function Q(){!C||!z||q({sampleResolution:n["Internal: ECG Sample Resolution"]}).then(()=>{requestAnimationFrame(()=>{const t=C.parentElement.getBoundingClientRect(),i={rows:1,cols:1,heartRateMode:"manual",manualHeartRate:n["Internal: Initial Heart Rate"],trailLifePercent:n["ECG Trail Life"].value,lineWidth:n["ECG Trace Width"].value,headDotRadius:n["ECG Head Size"].value,colorCore:O(n["ECG Trace Color"].value,.95),gridSize:n["ECG Grid Size"].value,showGrid:n["Internal: ECG Show Grid"],gridColor:n["Internal: ECG Grid Color"],renderWidth:t.width,renderHeight:t.height,viewportHorizontalPadding:n["Internal: ECG Viewport Horizontal Padding"],viewportVerticalPadding:n["Internal: ECG Viewport Vertical Padding"],heartRateDrift:n["Internal: ECG Heart Rate Drift"]};r=new N(C,i),g=new _(r),g.start(),T(),r.traces[0],r.setHeartRateMode("manual"),r.setManualHeartRate(n["Internal: Initial Heart Rate"]),a&&a.setHeartRate1(n["Internal: Initial Heart Rate"]),setTimeout(()=>{const s=n["Internal: Initial Heart Rate"];p&&(p.textContent=s),h&&(h.textContent=s),d&&(d.value=s)},50),U(),X()})})}function T(){$(z,{rows:1,cols:1,gridSize:n["ECG Grid Size"].value,gridColorMajor:n["Internal: ECG Grid Color Major"],gridColorPanel:n["Internal: ECG Grid Color Panel"],showGridOuterBox:n["ECG Show Outer Box"].value,showGridLines:n["ECG Show Grid Lines"].value,showGridBackground:n["Internal: ECG Show Grid Background"],gridGapPercent:n["Internal: ECG Grid Gap Percent"],viewportHorizontalPadding:n["Internal: ECG Viewport Horizontal Padding"],viewportVerticalPadding:n["Internal: ECG Viewport Vertical Padding"]})}m=T;function U(){window.addEventListener("resize",B),window.ResizeObserver&&new ResizeObserver(B).observe(C.parentElement||C)}function B(){if(!r)return;const e=C.parentElement.getBoundingClientRect();r.updateDimensions(e.width,e.height),m&&m()}function X(){d&&(d.value=n["Internal: Initial Heart Rate"],d.addEventListener("input",()=>{const e=+d.value;r&&(r.setManualHeartRate(e),r.setHeartRateMode("manual")),a&&a.setHeartRate1(e),p&&(p.textContent=e),h&&(h.textContent=e),ne()}))}function Y(){Object.keys(l).forEach(e=>{const t=document.getElementById(`counter-${e}`);if(t){const i=t.parentElement;S(i,e)}}),Object.keys(l).forEach(e=>{const t=document.getElementById(`counter-${e}`);if(t){const i=t.parentElement;i.addEventListener("click",()=>Z(e,i))}})}function Z(e,t){l[e]=!l[e],S(t,e),a&&a.setActivityLevels({[e]:l[e]?1:0})}function S(e,t){const i=l[t],s=e.querySelector(".signal-type-counter"),o=e.querySelector(".signal-type-label");i?(e.className="signal-type-item active",s.style.color="var(--accent, #00ff6a)",s.style.textShadow="0 0 10px rgba(0,255,106,0.5)",o.style.color="var(--accent, #00ff6a)"):(e.className="signal-type-item inactive",s.style.color="var(--text-dim, #666)",s.style.textShadow="none",o.style.color="var(--text-dim, #666)")}function K(){const e=G.getBoundingClientRect();if(a=new W(G,{mode:n["Internal: Signal Mode"],heartRate1:n["Internal: Initial Heart Rate"],heartRate2:n["Internal: Signal Secondary Heart Rate"],fadeRate:n["Signal Fade Rate"].value,renderWidth:e.width,renderHeight:e.height}),a.setActivityLevels({a1:1,a:0,b:0,c:0,d:0,e:0}),te(),Q(),Y(),ee(),a&&r){const t=n["Internal: Initial Heart Rate"];a.setHeartRate1(t),r.setManualHeartRate(t),r.setHeartRateMode("manual")}a.animate(),setTimeout(()=>{const t=+d.value||n["Internal: Initial Heart Rate"];a&&a.setHeartRate1(t)},100),j({title:"Signal Single Configuration"})}function ee(){const e=()=>{a&&r&&g?(v(),a.animate(),g&&!g.isRunning&&g.start(),R()):setTimeout(e,50)};e()}function te(){window.addEventListener("resize",x),window.ResizeObserver&&new ResizeObserver(x).observe(G)}function x(){if(!a)return;const e=G.getBoundingClientRect();a.updateDimensions(e.width,e.height)}let w=null;function v(){w=performance.now()}function u(e,t){const i=e/6e4;return Math.floor(t*i)}function ne(){if(w&&v(),r){const e=+d.value;r.setManualHeartRate(e),r.setHeartRateMode("manual")}}function M(){v(),Object.keys(c).forEach(e=>{c[e]=0}),l={a1:!0,a:!1,b:!1,c:!1,d:!1,e:!1},a&&a.setActivityLevels({a1:1,a:0,b:0,c:0,d:0,e:0}),Object.keys(l).forEach(e=>{const t=document.getElementById(`counter-${e}`);if(t){const i=t.parentElement;S(i,e)}}),R()}document.addEventListener("keydown",e=>{(e.key==="r"||e.key==="R")&&M()});window.addEventListener("message",e=>{e.data==="reset"&&M()});document.addEventListener("keydown",e=>{e.ctrlKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight")&&window.parent.postMessage({type:"keydown",key:e.key,ctrlKey:e.ctrlKey},"*")});function R(){if(!a||!w)return;const t=performance.now()-w,i=+d.value,s=u(i,t);H&&(H.textContent=s);const o=i,L=n["Internal: Signal Rate 2 BPM"],P=l.a1?u(o,t):0;let y=0;l.a&&n["Internal: Signal A Offsets"].forEach(f=>{const V=Math.max(0,t-f*1e3);y+=u(o,V)});const k=y,A=l.b?u(L,Math.max(0,t-n["Internal: Signal B Offset"])):0;n["Internal: Signal CF Offsets"];const I=n["Internal: Signal CF Individual Offsets"];c.a1=P,c.a=k,c.b=A,c.c=l.c?u(o,Math.max(0,t-I[0])):0,c.d=l.d?u(o,Math.max(0,t-I[1])):0,c.e=l.e?u(o,Math.max(0,t-I[2])):0,Object.keys(c).forEach(E=>{const f=document.getElementById(`counter-${E}`);f&&(f.textContent=c[E])});const F=Object.values(c).reduce((E,f)=>E+f,0);b&&(b.textContent=J(F)),requestAnimationFrame(R)}document.addEventListener("DOMContentLoaded",()=>{try{const e=document.getElementById("ecg-hr");e&&(e.value=n["Internal: Initial Heart Rate"]),K(),window.signalSingleInstance={renderer:a}}catch(e){console.error("Failed to initialize SignalSingle:",e),ae(e)}});function ae(e){const t=document.createElement("div");Object.assign(t.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 0, 0, 0.9)",color:"white",padding:"20px",borderRadius:"10px",fontFamily:"monospace",maxWidth:"80vw",maxHeight:"80vh",overflow:"auto"}),t.innerHTML=`
    <h2>Initialization Error</h2>
    <pre style="white-space: pre-wrap; word-wrap: break-word;">${e.message}</pre>
    <pre style="white-space: pre-wrap; word-wrap: break-word;">${e.stack}</pre>
  `,document.body.appendChild(t)}
