import{r as D,c as W}from"./overlayControls-D9GsMX9d.js";/* empty css              */import{S as j}from"./signalBatchRenderer-O_VuUkYA.js";import{h as x,d as $,e as q,M as N,B as _}from"./color-t7R1qBCU.js";import"./signalSquare-Bn1rA2Su.js";const t={"Signal Fade Rate":{value:1.2,type:"range",min:.1,max:3,step:.1,label:"Signal Fade Rate",section:"Signal Display"},"ECG Trace Width":{value:4,type:"range",min:.5,max:16,step:.1,label:"Trace Width",section:"ECG Trace"},"ECG Head Size":{value:10,type:"range",min:2,max:28,step:.5,label:"Head Dot Size",section:"ECG Trace"},"ECG Trail Life":{value:65,type:"range",min:5,max:200,step:1,label:"Trail Life (%)",section:"ECG Trace"},"ECG Trace Color":{value:"#00ff6a",type:"color",label:"Trace Color",section:"ECG Trace"},"ECG Grid Size":{value:100,type:"range",min:20,max:160,step:2,label:"Grid Size",section:"ECG Grid"},"ECG Show Outer Box":{value:!0,type:"checkbox",label:"Show Outer Box",section:"ECG Grid"},"ECG Show Grid Lines":{value:!0,type:"checkbox",label:"Show Grid Lines",section:"ECG Grid"},"Internal: ECG Sample Resolution":3200,"Internal: ECG Viewport Horizontal Padding":.02,"Internal: ECG Viewport Vertical Padding":.02,"Internal: ECG Heart Rate Drift":!1,"Internal: ECG Show Grid":!0,"Internal: ECG Grid Color":"#00ff6a","Internal: ECG Grid Color Major":"#00ff6a","Internal: ECG Grid Color Panel":"#00ff6a","Internal: ECG Show Grid Background":!0,"Internal: ECG Grid Gap Percent":0,"Internal: Signal Secondary Heart Rate":26,"Internal: Signal Mode":"single","Internal: Signal Rate 2 BPM":26,"Internal: Initial Heart Rate":62,"Internal: Signal A Offsets":[.1,.2,.3,.4],"Internal: Signal B Offset":50,"Internal: Signal CF Offsets":[.15,.3,.45],"Internal: Signal CF Individual Offsets":[150,300,450]};D("config",t,{onChange:(e,n,o)=>{if(e==="Signal Fade Rate"){a&&a.setFadeRate(n);return}if(["ECG Trace Width","ECG Head Size","ECG Trail Life","ECG Overlap","ECG Trace Color","ECG Grid Size","ECG Show Outer Box","ECG Show Grid Lines"].includes(e)){if(!r)return;const i={};e==="ECG Trace Width"?i.lineWidth=n:e==="ECG Head Size"?i.headDotRadius=n:e==="ECG Trail Life"?i.trailLifePercent=n:e==="ECG Trace Color"?(i.colorCore=x(n,.95),r._colorCore=new Float32Array(r.cfg.colorCore)):(e==="ECG Grid Size"||e==="ECG Show Outer Box"||e==="ECG Show Grid Lines")&&G&&G(),Object.keys(i).length>0&&r.updateConfig(i);return}}});function J(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}const m=document.getElementById("single-container"),y=document.getElementById("single-pulses"),O=document.getElementById("ecg-grid-canvas"),C=document.getElementById("ecg-trace-canvas"),p=document.getElementById("ecg-bpm"),b=document.getElementById("ecg-beats"),d=document.getElementById("ecg-hr"),h=document.getElementById("ecg-val-hr");let a=null,l={a1:!0,a:!1,b:!1,c:!1,d:!1,e:!1},c={a1:0,a:0,b:0,c:0,d:0,e:0},r=null,f=null,G=null;function Q(){!C||!O||q({sampleResolution:t["Internal: ECG Sample Resolution"]}).then(()=>{requestAnimationFrame(()=>{const n=C.parentElement.getBoundingClientRect(),o={rows:1,cols:1,heartRateMode:"manual",manualHeartRate:t["Internal: Initial Heart Rate"],trailLifePercent:t["ECG Trail Life"].value,lineWidth:t["ECG Trace Width"].value,headDotRadius:t["ECG Head Size"].value,colorCore:x(t["ECG Trace Color"].value,.95),gridSize:t["ECG Grid Size"].value,showGrid:t["Internal: ECG Show Grid"],gridColor:t["Internal: ECG Grid Color"],renderWidth:n.width,renderHeight:n.height,viewportHorizontalPadding:t["Internal: ECG Viewport Horizontal Padding"],viewportVerticalPadding:t["Internal: ECG Viewport Vertical Padding"],heartRateDrift:t["Internal: ECG Heart Rate Drift"]};r=new N(C,o),f=new _(r),f.start(),z(),r.traces[0],r.setHeartRateMode("manual"),r.setManualHeartRate(t["Internal: Initial Heart Rate"]),a&&a.setHeartRate1(t["Internal: Initial Heart Rate"]),setTimeout(()=>{const s=t["Internal: Initial Heart Rate"];h&&(h.textContent=s),p&&(p.textContent=s),d&&(d.value=s)},50),U(),X()})})}function z(){$(O,{rows:1,cols:1,gridSize:t["ECG Grid Size"].value,gridColorMajor:t["Internal: ECG Grid Color Major"],gridColorPanel:t["Internal: ECG Grid Color Panel"],showGridOuterBox:t["ECG Show Outer Box"].value,showGridLines:t["ECG Show Grid Lines"].value,showGridBackground:t["Internal: ECG Show Grid Background"],gridGapPercent:t["Internal: ECG Grid Gap Percent"],viewportHorizontalPadding:t["Internal: ECG Viewport Horizontal Padding"],viewportVerticalPadding:t["Internal: ECG Viewport Vertical Padding"]})}G=z;function U(){window.addEventListener("resize",H),window.ResizeObserver&&new ResizeObserver(H).observe(C.parentElement||C)}function H(){if(!r)return;const e=C.parentElement.getBoundingClientRect();r.updateDimensions(e.width,e.height),G&&G()}function X(){d&&(d.value=t["Internal: Initial Heart Rate"],d.addEventListener("input",()=>{const e=+d.value;r&&(r.setManualHeartRate(e),r.setHeartRateMode("manual")),a&&a.setHeartRate1(e),h&&(h.textContent=e),p&&(p.textContent=e),ne()}))}function Y(){Object.keys(l).forEach(e=>{const n=document.getElementById(`counter-${e}`);if(n){const o=n.parentElement;T(o,e)}}),Object.keys(l).forEach(e=>{const n=document.getElementById(`counter-${e}`);if(n){const o=n.parentElement;o.addEventListener("click",()=>Z(e,o))}})}function Z(e,n){l[e]=!l[e],T(n,e),a&&a.setActivityLevels({[e]:l[e]?1:0})}function T(e,n){const o=l[n],s=e.querySelector(".signal-type-counter"),i=e.querySelector(".signal-type-label");o?(e.className="signal-type-item active",s.style.color="var(--accent, #00ff6a)",s.style.textShadow="0 0 10px rgba(0,255,106,0.5)",i.style.color="var(--accent, #00ff6a)"):(e.className="signal-type-item inactive",s.style.color="var(--text-dim, #666)",s.style.textShadow="none",i.style.color="var(--text-dim, #666)")}function K(){const e=m.getBoundingClientRect();if(a=new j(m,{mode:t["Internal: Signal Mode"],heartRate1:t["Internal: Initial Heart Rate"],heartRate2:t["Internal: Signal Secondary Heart Rate"],fadeRate:t["Signal Fade Rate"].value,renderWidth:e.width,renderHeight:e.height}),a.setActivityLevels({a1:1,a:0,b:0,c:0,d:0,e:0}),te(),Q(),Y(),ee(),a&&r){const n=t["Internal: Initial Heart Rate"];a.setHeartRate1(n),r.setManualHeartRate(n),r.setHeartRateMode("manual")}a.animate(),setTimeout(()=>{const n=+d.value||t["Internal: Initial Heart Rate"];a&&a.setHeartRate1(n)},100),W({title:"Signal Single Configuration"})}function ee(){const e=()=>{a&&r&&f?(I(),a.animate(),f&&!f.isRunning&&f.start(),v()):setTimeout(e,50)};e()}function te(){window.addEventListener("resize",B),window.ResizeObserver&&new ResizeObserver(B).observe(m)}function B(){if(!a)return;const e=m.getBoundingClientRect();a.updateDimensions(e.width,e.height)}let w=null;function I(){w=performance.now()}function u(e,n){const o=e/6e4;return Math.floor(n*o)}function ne(){if(w&&I(),r){const e=+d.value;r.setManualHeartRate(e),r.setHeartRateMode("manual")}}function M(){I(),Object.keys(c).forEach(e=>{c[e]=0}),v()}document.addEventListener("keydown",e=>{(e.key==="r"||e.key==="R")&&M()});window.addEventListener("message",e=>{e.data==="reset"&&M()});document.addEventListener("keydown",e=>{e.ctrlKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight")&&window.parent.postMessage({type:"keydown",key:e.key,ctrlKey:e.ctrlKey},"*")});function v(){if(!a||!w)return;const n=performance.now()-w,o=+d.value,s=u(o,n);b&&(b.textContent=s);const i=o,P=t["Internal: Signal Rate 2 BPM"],L=l.a1?u(i,n):0;let R=0;l.a&&t["Internal: Signal A Offsets"].forEach(g=>{const V=Math.max(0,n-g*1e3);R+=u(i,V)});const k=R,A=l.b?u(P,Math.max(0,n-t["Internal: Signal B Offset"])):0;t["Internal: Signal CF Offsets"];const S=t["Internal: Signal CF Individual Offsets"];c.a1=L,c.a=k,c.b=A,c.c=l.c?u(i,Math.max(0,n-S[0])):0,c.d=l.d?u(i,Math.max(0,n-S[1])):0,c.e=l.e?u(i,Math.max(0,n-S[2])):0,Object.keys(c).forEach(E=>{const g=document.getElementById(`counter-${E}`);g&&(g.textContent=c[E])});const F=Object.values(c).reduce((E,g)=>E+g,0);y&&(y.textContent=J(F)),requestAnimationFrame(v)}document.addEventListener("DOMContentLoaded",()=>{try{const e=document.getElementById("ecg-hr");e&&(e.value=t["Internal: Initial Heart Rate"]),K(),window.signalSingleInstance={renderer:a}}catch(e){console.error("Failed to initialize SignalSingle:",e),ae(e)}});function ae(e){const n=document.createElement("div");Object.assign(n.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 0, 0, 0.9)",color:"white",padding:"20px",borderRadius:"10px",fontFamily:"monospace",maxWidth:"80vw",maxHeight:"80vh",overflow:"auto"}),n.innerHTML=`
    <h2>Initialization Error</h2>
    <pre style="white-space: pre-wrap; word-wrap: break-word;">${e.message}</pre>
    <pre style="white-space: pre-wrap; word-wrap: break-word;">${e.stack}</pre>
  `,document.body.appendChild(n)}
