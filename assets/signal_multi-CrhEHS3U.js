import{r as T,c as x,a as L}from"./overlayControls_new-C67KsuMk.js";/* empty css              */import{S as z}from"./signalBatchRenderer-E0200ibZ.js";class M{constructor(t,e){this.container=t,this.config=e,this.enabled=!1}init(){}setEnabled(t){this.enabled=t}update(t){}triggerPulse(t,e,i,a,o,s){}dispose(){}getConfigOptions(){return[]}updateConfig(t){Object.assign(this.config,t)}}class p{static sharedTemplates=new Map;constructor(t,e,i,a,o,s,r=0,c={}){this.startX=t,this.startY=e,this.endX=i,this.endY=a,this.column=o,this.row=s,this.bundleCenterX=r,this.config=c||{};const h=this.config||{},d=`col_${o}_row_${s}_strength_${h.wireCurveStrength||25}`;p.sharedTemplates.has(d)?this.reuseSharedTemplate(d):(this.computeNewTemplate(),p.sharedTemplates.set(d,{relativeControlX:this.relativeControlX,relativeControlY:this.relativeControlY,curvePoints:this.curvePoints})),this.computeAbsoluteCoordinates()}reuseSharedTemplate(t){const e=p.sharedTemplates.get(t);this.relativeControlX=e.relativeControlX,this.relativeControlY=e.relativeControlY,this.curvePoints=e.curvePoints}computeNewTemplate(){this.relativeControlX=this.calculateRelativeControlX(),this.relativeControlY=this.calculateRelativeControlY(),this.precomputeRelativeCurvePoints()}computeAbsoluteCoordinates(){const t=(this.startX+this.endX)/2,e=(this.startY+this.endY)/2;this.controlX=t+this.relativeControlX,this.controlY=e+this.relativeControlY,this.absoluteCurvePoints=this.curvePoints.map(i=>({x:t+i.x,y:e+i.y,t:i.t}))}calculateRelativeControlX(){const t=this.config.wireCurveStrength||25;let e=0;this.column===0?e=-t*1.2:this.column===1?e=-t*.6:this.column===3?e=t*.6:this.column===4&&(e=t*1.2);const i=this.endX-this.startX,a=this.endY-this.startY,o=Math.sqrt(i*i+a*a);return a/o*e}calculateRelativeControlY(){const t=this.config.wireCurveStrength||25;let e=0;this.column===0?e=-t*1.2:this.column===1?e=-t*.6:this.column===3?e=t*.6:this.column===4&&(e=t*1.2);const i=this.endX-this.startX,a=this.endY-this.startY,o=Math.sqrt(i*i+a*a);return-i/o*e}precomputeRelativeCurvePoints(){this.curvePoints=[];const t=12;for(let e=0;e<=t;e++){const i=e/t,a=this.startX-(this.startX+this.endX)/2,o=this.startY-(this.startY+this.endY)/2,s=this.endX-(this.startX+this.endX)/2,r=this.endY-(this.startY+this.endY)/2,c=this.relativeControlX,h=this.relativeControlY,d=(1-i)*(1-i)*a+2*(1-i)*i*c+i*i*s,u=(1-i)*(1-i)*o+2*(1-i)*i*h+i*i*r;this.curvePoints.push({x:d,y:u,t:i})}}getPointAtProgress(t){const e=Math.floor(t*(this.absoluteCurvePoints.length-1)),i=Math.min(e+1,this.absoluteCurvePoints.length-1),a=this.absoluteCurvePoints[e],o=this.absoluteCurvePoints[i],s=t*(this.absoluteCurvePoints.length-1)-e;return{x:a.x+(o.x-a.x)*s,y:a.y+(o.y-a.y)*s}}drawInactive(t){const e=t.createLinearGradient(this.startX,this.startY,this.endX,this.endY);e.addColorStop(0,"rgba(68,68,68,0.4)"),e.addColorStop(.6,"rgba(68,68,68,0.4)"),e.addColorStop(1,"rgba(68,68,68,0)"),t.strokeStyle=e,t.lineWidth=this.config.wireLineThickness||1.5,t.globalAlpha=1,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(this.startX,this.startY),t.quadraticCurveTo(this.controlX,this.controlY,this.endX,this.endY),t.stroke()}}class E{constructor(t,e,i,a,o=0,s=0,r=0,c=0,h){this.template=new p(t,e,i,a,o,s,r,h),this.isActive=!1,this.pulseProgress=0,this.pulseSpeed=h.wirePulseSpeed||2.2,this.lastPulseTime=0,this.bundleIndex=c,this.column=o,this.row=s,this.uniqueId=`bundle_${c}_col_${o}_row_${s}`}triggerPulse(){this.isActive=!0,this.pulseProgress=0,this.lastPulseTime=performance.now()}update(t){return this.isActive&&(this.pulseProgress+=this.pulseSpeed*(t-this.lastPulseTime)/1e3,this.pulseProgress>=1&&(this.isActive=!1,this.pulseProgress=0)),this.lastPulseTime=t,this.isActive&&this.pulseProgress>0}drawInactive(t){this.template.drawInactive(t)}drawPulse(t,e){if(e<.02||e>.99)return;const i=5,a=.15,o=(1-e)*1.5;if(!(o<=.005)){t.fillStyle="#00ff6a",t.shadowColor="#00ff6a";for(let s=0;s<i;s++){const r=e-s*a/i;if(r<0)continue;const c=o*(1-s/i)*(1-r);if(c<=.005)continue;const h=this.template.getPointAtProgress(r);t.globalAlpha=c,t.shadowBlur=8+s*.8,t.beginPath(),t.arc(h.x,h.y,2-s*.12,0,Math.PI*2),t.fill(),s===0&&(t.globalAlpha=Math.min(1,c*1.4),t.shadowBlur=8,t.beginPath(),t.arc(h.x,h.y,1.1,0,Math.PI*2),t.fill())}}}}class k{constructor(t,e){this.container=t,this.config=e,this.canvas=null,this.ctx=null,this.lines=new Map,this.enabled=!1,this.lastTime=0,this.lastInactiveDraw=0,this.inactiveCanvas=null,this.inactiveCtx=null,this.inactiveDirty=!0,this.activePulses=new Map,this.init()}init(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex="10",this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.ctx||console.error("WireAnimator: Failed to get 2D context!"),this.inactiveCanvas=document.createElement("canvas"),this.inactiveCtx=this.inactiveCanvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.inactiveCanvas.width=this.canvas.width,this.inactiveCanvas.height=this.canvas.height,this.ctx&&(this.ctx.fillStyle="rgba(255, 0, 0, 0.1)",this.ctx.fillRect(10,10,50,50)),this.inactiveDirty=!0)}updateSquarePosition(t,e,i,a,o,s=0,r=0,c=0,h=0){if(!this.lines.has(t))this.lines.set(t,new E(e,i,a,o,s,r,c,h,this.config)),this.inactiveDirty=!0;else{const u=this.lines.get(t);(u.template.startX!==e||u.template.startY!==i||u.template.endX!==a||u.template.endY!==o)&&(u.template.startX=e,u.template.startY=i,u.template.endX=a,u.template.endY=o,u.template.bundleCenterX=c,u.template.computeAbsoluteCoordinates(),this.inactiveDirty=!0)}}triggerPulse(t){if(!this.enabled||!this.lines.has(t))return;const e=this.lines.get(t);e.triggerPulse(),this.activePulses.set(e.uniqueId,e)}update(t){if(this.enabled&&(this.lastTime&&(t-this.lastTime)/1e3,this.lastTime=t,this.inactiveDirty&&(this.drawInactiveLinesToOffscreen(),this.inactiveDirty=!1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.inactiveCanvas,0,0),this.activePulses.size>0)){this.ctx.save();const e=[];for(const[i,a]of this.activePulses)a.update(t)?a.drawPulse(this.ctx,a.pulseProgress):e.push(i);e.forEach(i=>this.activePulses.delete(i)),this.ctx.restore()}}drawInactiveLinesToOffscreen(){this.inactiveCtx.clearRect(0,0,this.inactiveCanvas.width,this.inactiveCanvas.height),this.inactiveCtx.lineWidth=this.config.wireLineThickness||1.5,this.inactiveCtx.globalAlpha=1,this.inactiveCtx.lineCap="round",this.inactiveCtx.lineJoin="round",this.lines.forEach(t=>{const e=this.inactiveCtx.createLinearGradient(t.template.startX,t.template.startY,t.template.endX,t.template.endY);e.addColorStop(0,"rgba(68,68,68,0.4)"),e.addColorStop(.6,"rgba(68,68,68,0.4)"),e.addColorStop(1,"rgba(68,68,68,0)"),this.inactiveCtx.strokeStyle=e,this.inactiveCtx.beginPath(),this.inactiveCtx.moveTo(t.template.startX,t.template.startY),this.inactiveCtx.quadraticCurveTo(t.template.controlX,t.template.controlY,t.template.endX,t.template.endY),this.inactiveCtx.stroke()})}drawInactiveLines(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.inactiveCanvas,0,0)}setEnabled(t){this.enabled=t,t?this.drawInactiveLines():this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}initializeAllLines(t){if(!t)return;this.lines.clear(),t.getBundles().forEach((i,a)=>{i.getAllSquares().forEach(s=>{const r=t.config.squareSize,c=t.config.spacing;t.config.counterHeight;const d=5*r+4*c,u=i.position.x-d/2+r/2,g=2*r+c,f=i.position.y+g/2-r/2,S=u+s.column*(r+c),y=f-s.row*(r+c),C={x:S,y},m=t.worldToScreen(C),v=this.getBundleCounterPosition(i,a,t,s.column),A=i.position.x,P=`bundle_${a}_square_${s.column}_${s.row}`;this.updateSquarePosition(P,m.x,m.y,v.x,v.y,s.column,s.row,A,a)})}),this.drawInactiveLines()}getBundleCounterPosition(t,e,i,a=2){const o=i.config.spacing,s=i.config.counterHeight,r=i.config.squareSize,c=2*r+o,h=s*r+(s-1)*o,d=t.position.y-c/2-o-h/2,u={x:t.position.x,y:d};return i.worldToScreen(u)}dispose(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.lines.clear(),this.activePulses.clear(),p.sharedTemplates.clear()}}class R extends M{constructor(t,e){super(t,e),this.pulseLineSystem=null}init(){this.pulseLineSystem=new k(this.container,this.config),this.pulseLineSystem.setEnabled(!1)}setEnabled(t){super.setEnabled(t),this.pulseLineSystem&&this.pulseLineSystem.setEnabled(t)}update(t){this.pulseLineSystem&&this.pulseLineSystem.update(t)}triggerPulse(t,e,i,a,o,s){!this.pulseLineSystem||!this.enabled||(this.pulseLineSystem.updateSquarePosition(t,e.x,e.y,i.x,i.y,a,o,0,s),this.pulseLineSystem.triggerPulse(t))}initializeAllLines(t){this.pulseLineSystem&&this.pulseLineSystem.initializeAllLines(t)}dispose(){this.pulseLineSystem&&this.pulseLineSystem.dispose()}getConfigOptions(){return[{type:"range",name:"wireLineThickness",label:"Line Thickness",value:this.config.wireLineThickness||1.5,min:.5,max:5,step:.1},{type:"range",name:"wireCurveStrength",label:"Curve Strength",value:this.config.wireCurveStrength||25,min:5,max:50,step:1},{type:"range",name:"wirePulseSpeed",label:"Pulse Speed",value:this.config.wirePulseSpeed||2.2,min:.5,max:5,step:.1}]}updateConfig(t){super.updateConfig(t),this.pulseLineSystem&&(this.pulseLineSystem.config=this.config,this.pulseLineSystem.inactiveDirty!==void 0&&(this.pulseLineSystem.inactiveDirty=!0))}}class X{constructor(t,e,i,a,o){this.x=t,this.y=e,this.targetX=i,this.targetY=a,this.color=o.particleColor||"#23CD3C",this.size=o.particleSize||1.44,this.glow=o.particleGlow||.5,this.travelTime=o.particleTravelTime||.5,this.startTime=performance.now()/1e3,this.elapsed=0;const s=i-t,r=a-e;this.distance=Math.sqrt(s*s+r*r),this.distance===0?(this.speed=0,this.dirX=0,this.dirY=0):(this.speed=this.distance/this.travelTime,this.dirX=s/this.distance,this.dirY=r/this.distance),this.life=1,this.maxLife=1,this.alpha=1}update(t){if(this.elapsed+=t,this.elapsed<this.travelTime){const i=this.speed*t;this.x+=this.dirX*i,this.y+=this.dirY*i}else this.x=this.targetX,this.y=this.targetY;const e=Math.min(this.elapsed/this.travelTime,1);return this.alpha=1-e,this.alpha>0}draw(t){this.alpha<=0||(t.save(),t.globalAlpha=this.alpha,this.glow>0&&(t.shadowColor=this.color,t.shadowBlur=this.size*this.glow*4,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill(),t.restore())}}class Y{constructor(t,e){this.container=t,this.config=e,this.canvas=null,this.ctx=null,this.particles=[],this.particlePool=[],this.enabled=!1,this.maxParticles=1e4,this.lastTime=0,this.lastUpdateTime=0,this.init()}init(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex="10",this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.ctx||console.error("ParticleAnimator: Failed to get 2D context!"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx&&(this.ctx.fillStyle="rgba(0, 255, 0, 0.1)",this.ctx.fillRect(70,10,50,50)))}spawnParticle(t,e,i,a){if(!this.enabled||this.particles.length>=this.maxParticles)return;const o=this.config.particleTravelTime||.5;let s;if(this.particlePool.length>0){s=this.particlePool.pop(),s.x=t,s.y=e,s.targetX=i,s.targetY=a,s.color=this.config.particleColor||"#23CD3C",s.size=this.config.particleSize||1.44,s.glow=this.config.particleGlow||.5,s.travelTime=o,s.startTime=performance.now()/1e3,s.elapsed=0;const r=i-t,c=a-e;s.distance=Math.sqrt(r*r+c*c),s.distance===0?(s.speed=0,s.dirX=0,s.dirY=0):(s.speed=s.distance/o,s.dirX=r/s.distance,s.dirY=c/s.distance),s.life=1,s.maxLife=1,s.alpha=1}else{s=new X(t,e,i,a,this.config),s.travelTime=o;const r=i-t,c=a-e;s.distance=Math.sqrt(r*r+c*c),s.distance===0?(s.speed=0,s.dirX=0,s.dirY=0):(s.speed=s.distance/o,s.dirX=r/s.distance,s.dirY=c/s.distance)}this.particles.push(s)}update(t){if(!this.enabled)return;const e=this.lastTime?(t-this.lastTime)/1e3:0;if(this.lastTime=t,this.lastUpdateTime&&t-this.lastUpdateTime<16)return;this.lastUpdateTime=t;const i=[];this.particles.forEach(a=>{a.update(e)?i.push(a):this.particlePool.push(a)}),this.particles=i,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(a=>a.draw(this.ctx))}setEnabled(t){this.enabled=t,t||(this.particles.forEach(e=>this.particlePool.push(e)),this.particles=[],this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}dispose(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.particles.forEach(t=>this.particlePool.push(t)),this.particles=[],this.particlePool=[]}}class D extends M{constructor(t,e){super(t,e),this.particleSystem=null}init(){this.particleSystem=new Y(this.container,this.config)}setEnabled(t){super.setEnabled(t),this.particleSystem&&this.particleSystem.setEnabled(t)}update(t){this.particleSystem&&this.particleSystem.update(t)}triggerPulse(t,e,i,a,o,s){!this.particleSystem||!this.enabled||this.particleSystem.spawnParticle(e.x,e.y,i.x,i.y)}dispose(){this.particleSystem&&this.particleSystem.dispose()}getConfigOptions(){return[{type:"range",name:"particleSize",label:"Particle Size",value:this.config.particleSize||1.44,min:.5,max:5,step:.1},{type:"range",name:"particleGlow",label:"Particle Glow",value:this.config.particleGlow||.5,min:0,max:2,step:.1},{type:"range",name:"particleTravelTime",label:"Travel Time (s)",value:this.config.particleTravelTime||.5,min:.1,max:2,step:.1},{type:"color",name:"particleColor",label:"Particle Color",value:this.config.particleColor||"#23CD3C"}]}updateConfig(t){super.updateConfig(t),this.particleSystem&&(this.particleSystem.config=this.config)}}const l={"Signal Multi: Bundle Spacing":{type:"range",label:"Bundle Spacing (squares)",value:.65,min:.1,max:2,step:.05,section:"Bundle Layout"},"Signal Multi: Page Perimeter":{type:"range",label:"Page Perimeter (squares)",value:2.5,min:0,max:10,step:.5,section:"Bundle Layout"},"Signal Multi: Counter Height":{type:"range",label:"Counter Height (squares)",value:2,min:1,max:5,step:.1,section:"Bundle Layout"},"Signal Multi: Primary Rate":{type:"range",label:"Primary Rate (BPM)",value:85,min:30,max:180,step:1,section:"Pulse Rates"},"Signal Multi: Secondary Rate":{type:"range",label:"Secondary Rate (BPM)",value:26,min:10,max:100,step:1,section:"Pulse Rates"},"Signal Multi: Rate Variation":{type:"range",label:"Rate Variation (%)",value:35,min:0,max:100,step:1,section:"Pulse Rates"},"Signal Multi: Fade Rate":{type:"range",label:"Fade Rate",value:1,min:.1,max:3,step:.1,section:"Pulse Rates"},"Signal Multi: A1 Activity":{type:"range",label:"A1 Activity",value:100,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: A Activity":{type:"range",label:"A Activity",value:80,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: B Activity":{type:"range",label:"B Activity",value:65,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: C Activity":{type:"range",label:"C Activity",value:40,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: D Activity":{type:"range",label:"D Activity",value:30,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: E Activity":{type:"range",label:"E Activity",value:20,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: F Activity":{type:"range",label:"F Activity",value:5,min:0,max:100,step:5,section:"Activity Levels"},"Signal Multi: Text Scale":{type:"range",label:"Text Scale Factor",value:1.2,min:.5,max:2,step:.1,section:"Visual Effects"},"Signal Multi: Text Glow":{type:"range",label:"Text Glow",value:.6,min:0,max:1,step:.05,section:"Visual Effects"},"Signal Multi: Text Color":{type:"color",label:"Text Color",value:"#23CD3C",section:"Visual Effects"},"Signal Multi: Show Counters":{type:"checkbox",label:"Show Counters",value:!1,section:"Animation Settings"},"Signal Multi: Animation Type":{type:"select",label:"Animation Type",value:"wire",options:[{value:"none",label:"None"},{value:"wire",label:"Wire (Curved Lines)"},{value:"particle",label:"Particle (Straight)"}],section:"Animation Settings"},"Signal Multi: Enable Animation":{type:"checkbox",label:"Enable Animation",value:!1,section:"Animation Settings"},"Signal Multi: Wire Line Thickness":{type:"range",label:"Line Thickness",value:1.5,min:.5,max:5,step:.1,section:"Wire Animation",condition:n=>n["Signal Multi: Animation Type"].value==="wire"},"Signal Multi: Wire Curve Strength":{type:"range",label:"Curve Strength",value:25,min:5,max:50,step:1,section:"Wire Animation",condition:n=>n["Signal Multi: Animation Type"].value==="wire"},"Signal Multi: Wire Pulse Speed":{type:"range",label:"Pulse Speed",value:2.2,min:.5,max:5,step:.1,section:"Wire Animation",condition:n=>n["Signal Multi: Animation Type"].value==="wire"},"Signal Multi: Particle Size":{type:"range",label:"Particle Size",value:1.44,min:.5,max:5,step:.1,section:"Particle Animation",condition:n=>n["Signal Multi: Animation Type"].value==="particle"},"Signal Multi: Particle Glow":{type:"range",label:"Particle Glow",value:.5,min:0,max:2,step:.1,section:"Particle Animation",condition:n=>n["Signal Multi: Animation Type"].value==="particle"},"Signal Multi: Particle Travel Time":{type:"range",label:"Travel Time (s)",value:.5,min:.1,max:2,step:.1,section:"Particle Animation",condition:n=>n["Signal Multi: Animation Type"].value==="particle"},"Signal Multi: Particle Color":{type:"color",label:"Particle Color",value:"#23CD3C",section:"Particle Animation",condition:n=>n["Signal Multi: Animation Type"].value==="particle"},"Internal: Bundle Count":77,"Internal: Square Size":58,"Internal: Spacing":1,"Internal: Counter Delay":.5};class q{constructor(){this.renderer=null,this.time=0,this.fpsCounter=0,this.fpsLastTime=performance.now(),this.fpsFrames=0,this.updateTimeout=null,this.activeAnimator=null,this.lastPulseCounts=new Map,this.init()}init(){const t=document.getElementById("container");if(!t)throw new Error("Container element not found");this.container=t,this.renderer=new z(t,{mode:"multi",bundleCount:l["Internal: Bundle Count"],bundleSpacing:l["Signal Multi: Bundle Spacing"].value,pagePerimeter:l["Signal Multi: Page Perimeter"].value,counterHeight:l["Signal Multi: Counter Height"].value,heartRate1:l["Signal Multi: Primary Rate"].value,heartRate2:l["Signal Multi: Secondary Rate"].value,squareSize:l["Internal: Square Size"],spacing:l["Internal: Spacing"],activityLevels:{a1:l["Signal Multi: A1 Activity"].value/100,a:l["Signal Multi: A Activity"].value/100,b:l["Signal Multi: B Activity"].value/100,c:l["Signal Multi: C Activity"].value/100,d:l["Signal Multi: D Activity"].value/100,e:l["Signal Multi: E Activity"].value/100,f:l["Signal Multi: F Activity"].value/100},rateVariation:l["Signal Multi: Rate Variation"].value/100,fadeRate:l["Signal Multi: Fade Rate"].value,counterDelay:0,showCounters:l["Signal Multi: Show Counters"].value,renderWidth:window.innerWidth,renderHeight:window.innerHeight}),this.setupEventListeners(),this.setupLegendUpdates(),this.setupFPSCounter(),this.setAnimationType(l["Signal Multi: Animation Type"].value),this.renderer.animate(),this.updateText({scale:l["Signal Multi: Text Scale"].value,glow:l["Signal Multi: Text Glow"].value,color:l["Signal Multi: Text Color"].value});const e=document.getElementById("data-counter");if(e){const a=20*l["Signal Multi: Text Scale"].value;e.style.fontSize=a+"px"}}setAnimationType(t,e=!1){if(this.activeAnimator&&(this.activeAnimator.dispose(),this.activeAnimator=null),l["Signal Multi: Animation Type"].value=t,t==="wire")this.activeAnimator=new R(this.container,{wireLineThickness:l["Signal Multi: Wire Line Thickness"].value,wireCurveStrength:l["Signal Multi: Wire Curve Strength"].value,wirePulseSpeed:l["Signal Multi: Wire Pulse Speed"].value});else if(t==="particle")this.activeAnimator=new D(this.container,{particleSize:l["Signal Multi: Particle Size"].value,particleGlow:l["Signal Multi: Particle Glow"].value,particleTravelTime:l["Signal Multi: Particle Travel Time"].value,particleColor:l["Signal Multi: Particle Color"].value});else{this.activeAnimator=null;return}this.activeAnimator.init(),this.activeAnimator.setEnabled(e);const i=e?l["Internal: Counter Delay"]:0;this.renderer.setCounterDelay(i),e&&t==="wire"&&this.activeAnimator.initializeAllLines&&this.activeAnimator.initializeAllLines(this.renderer),L()}getAnimationConfigOptions(){return!this.activeAnimator||!this.activeAnimator.getConfigOptions?[]:this.activeAnimator.getConfigOptions()}updateAnimationConfig(t){Object.assign(l,t),this.activeAnimator&&this.activeAnimator.updateConfig&&this.activeAnimator.updateConfig(l)}setupEventListeners(){window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.renderer&&this.renderer.updateDimensions(window.innerWidth,window.innerHeight),this.activeAnimator&&(this.activeAnimator.setEnabled(!1),this.renderer.setCounterDelay(0))}setupLegendUpdates(){let t=0,e=0,i=0;const o=1e3/30,s=r=>{if(r-e>=50){let c=0;if(this.renderer)try{c=this.renderer.getTotalPulseCount()}catch{}t+=(c-t)*.1;const h=document.getElementById("data-counter");h&&(h.textContent="Total Pulses: "+formatNumberWithCommas(Math.round(t))),e=r}r-i>=o?(this.activeAnimator&&(this.activeAnimator.update(r),this.checkForNewPulses()),i=r):this.activeAnimator&&this.activeAnimator.update(r),requestAnimationFrame(s)};requestAnimationFrame(s)}checkForNewPulses(){if(!this.renderer||!this.activeAnimator||!this.activeAnimator.enabled)return;this.renderer.getBundles().forEach((e,i)=>{const a=e.getPulseCount(),o=this.lastPulseCounts.get(i)||0;a>o&&e.getAllSquares().forEach(r=>{const c=r.getPulseCount(),h=this.lastPulseCounts.get(`square_${i}_${r.column}_${r.row}`)||0;if(c>h){const d=this.renderer.config.squareSize,u=this.renderer.config.spacing;this.renderer.config.counterHeight;const f=5*d+4*u,S=e.position.x-f/2+d/2,y=2*d+u,C=e.position.y+y/2-d/2,m=S+r.column*(d+u),v=C-r.row*(d+u),A={x:m,y:v},P=this.renderer.worldToScreen(A),w=this.getBundleCounterPosition(e,i);if(w){const b=`bundle_${i}_square_${r.column}_${r.row}`;this.activeAnimator.triggerPulse(b,P,w,r.column,r.row,i)}}this.lastPulseCounts.set(`square_${i}_${r.column}_${r.row}`,c)}),this.lastPulseCounts.set(i,a)})}getBundleCounterPosition(t,e){const i=this.renderer.config.spacing,a=this.renderer.config.counterHeight,o=this.renderer.config.squareSize,s=2*o+i,r=a*o+(a-1)*i,c=t.position.y-s/2-i-r/2,h={x:t.position.x,y:c};return this.renderer.worldToScreen(h)}setupFPSCounter(){document.addEventListener("keydown",t=>{(t.key==="t"||t.key==="T")&&(t.preventDefault(),this.toggleCounters()),(t.key==="r"||t.key==="R")&&(t.preventDefault(),this.resetAllPulses()),(t.key==="p"||t.key==="P")&&(t.altKey||(t.preventDefault(),this.toggleAnimation())),(t.key==="t"||t.key==="T")&&t.altKey&&(t.preventDefault(),this.testPulse())})}toggleCounters(){l["Signal Multi: Show Counters"].value=!l["Signal Multi: Show Counters"].value,this.renderer&&this.renderer.setShowCounters(l["Signal Multi: Show Counters"].value)}resetAllPulses(){this.renderer&&this.renderer.getBundles().forEach(t=>t.resetPulseCount())}toggleAnimation(){if(!this.activeAnimator)if(l["Signal Multi: Animation Type"].value!=="none"){this.setAnimationType(l["Signal Multi: Animation Type"].value,!0);return}else return;const t=!this.activeAnimator.enabled;l["Signal Multi: Enable Animation"].value=t,this.activeAnimator.setEnabled(t),t&&l["Signal Multi: Animation Type"].value==="wire"&&this.activeAnimator.initializeAllLines&&this.activeAnimator.initializeAllLines(this.renderer);const e=t?l["Internal: Counter Delay"]:0;this.renderer.setCounterDelay(e)}setBundleSpacing(t){this.renderer&&(l["Signal Multi: Bundle Spacing"].value=Math.max(.1,Math.min(5,t)),this.renderer.setBundleSpacing(l["Signal Multi: Bundle Spacing"].value))}setPagePerimeter(t){this.renderer&&(l["Signal Multi: Page Perimeter"].value=Math.max(0,Math.min(20,t)),this.renderer.setPagePerimeter(l["Signal Multi: Page Perimeter"].value))}setCounterHeight(t){this.renderer&&(l["Signal Multi: Counter Height"].value=Math.max(.5,Math.min(10,t)),this.renderer.setCounterHeight(l["Signal Multi: Counter Height"].value))}setCounterDelay(t){this.renderer&&(l["Internal: Counter Delay"]=Math.max(0,Math.min(2,t)),this.renderer.setCounterDelay(l["Internal: Counter Delay"]))}setParticleSize(t){l["Signal Multi: Particle Size"].value=Math.max(.5,Math.min(3,t))}setParticleGlow(t){l["Signal Multi: Particle Glow"].value=Math.max(0,Math.min(1,t))}updateText({glow:t,scale:e,color:i}){if(!this.renderer)return;const a={};if(typeof t=="number"&&(l["Signal Multi: Text Glow"].value=t,a.glow=t*24),typeof e=="number"){l["Signal Multi: Text Scale"].value=e;const s=14*e;a.size=s}i&&(l["Signal Multi: Text Color"].value=i,a.color=i),Object.keys(a).length>0&&this.renderer.updateText(a)}setHeartRate1(t){this.renderer&&(l["Signal Multi: Primary Rate"].value=t,this.renderer.setHeartRate1(t))}setHeartRate2(t){this.renderer&&(l["Signal Multi: Secondary Rate"].value=t,this.renderer.setHeartRate2(t))}setActivityLevels(t){this.renderer&&(t.a1!==void 0&&(l["Signal Multi: A1 Activity"].value=Math.round(t.a1*100)),t.a!==void 0&&(l["Signal Multi: A Activity"].value=Math.round(t.a*100)),t.b!==void 0&&(l["Signal Multi: B Activity"].value=Math.round(t.b*100)),t.c!==void 0&&(l["Signal Multi: C Activity"].value=Math.round(t.c*100)),t.d!==void 0&&(l["Signal Multi: D Activity"].value=Math.round(t.d*100)),t.e!==void 0&&(l["Signal Multi: E Activity"].value=Math.round(t.e*100)),t.f!==void 0&&(l["Signal Multi: F Activity"].value=Math.round(t.f*100)),this.renderer.setActivityLevels(t))}testPulse(){if(this.renderer){const a=this.renderer.getBundles();if(a.length>0){const s=a[0].getAllSquares();s.length>0&&s[0]}}if(this.activeAnimator,!this.activeAnimator||!this.activeAnimator.enabled)return;const t={x:window.innerWidth/2,y:window.innerHeight/2},e={x:window.innerWidth/2,y:window.innerHeight/4};this.activeAnimator.triggerPulse("test_square",t,e,2,0,0);const i=document.createElement("div");i.style.position="absolute",i.style.left=t.x+"px",i.style.top=t.y+"px",i.style.width="10px",i.style.height="10px",i.style.background="red",i.style.borderRadius="50%",i.style.zIndex="1000",document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},1e3)}}document.addEventListener("DOMContentLoaded",()=>{try{const n=new q;window.signalMultiInstance=n,T("Signal Multi",l,{onChange:(t,e)=>{n.updateTimeout&&clearTimeout(n.updateTimeout),n.updateTimeout=setTimeout(()=>{try{if(!n.renderer||!n.renderer.isValidState)return;switch(t){case"Signal Multi: Bundle Spacing":n.setBundleSpacing(e);break;case"Signal Multi: Page Perimeter":n.setPagePerimeter(e);break;case"Signal Multi: Counter Height":n.setCounterHeight(e);break;case"Signal Multi: Primary Rate":n.renderer.setHeartRate1(+e);break;case"Signal Multi: Secondary Rate":n.renderer.setHeartRate2(+e);break;case"Signal Multi: Rate Variation":n.renderer.updateConfig({rateVariation:+e/100});break;case"Signal Multi: Fade Rate":n.renderer.setFadeRate(+e);break;case"Signal Multi: A1 Activity":n.renderer.setActivityLevels({a1:+e/100});break;case"Signal Multi: A Activity":n.renderer.setActivityLevels({a:+e/100});break;case"Signal Multi: B Activity":n.renderer.setActivityLevels({b:+e/100});break;case"Signal Multi: C Activity":n.renderer.setActivityLevels({c:+e/100});break;case"Signal Multi: D Activity":n.renderer.setActivityLevels({d:+e/100});break;case"Signal Multi: E Activity":n.renderer.setActivityLevels({e:+e/100});break;case"Signal Multi: F Activity":n.renderer.setActivityLevels({f:+e/100});break;case"Signal Multi: Text Scale":n.updateText({scale:+e});const i=document.getElementById("data-counter");if(i){const s=20*+e;i.style.fontSize=s+"px"}break;case"Signal Multi: Text Glow":n.updateText({glow:e});break;case"Signal Multi: Text Color":n.updateText({color:e});break;case"Signal Multi: Show Counters":n.renderer.setShowCounters(e);break;case"Signal Multi: Animation Type":const a=n.activeAnimator?n.activeAnimator.enabled:!1;n.setAnimationType(e,a);break;case"Signal Multi: Enable Animation":if(n.activeAnimator){n.activeAnimator.setEnabled(e);const o=e?l["Internal: Counter Delay"]:0;n.renderer.setCounterDelay(o),e&&l["Signal Multi: Animation Type"].value==="wire"&&n.activeAnimator.initializeAllLines&&n.activeAnimator.initializeAllLines(n.renderer)}break;case"Signal Multi: Wire Line Thickness":n.updateAnimationConfig({wireLineThickness:+e});break;case"Signal Multi: Wire Curve Strength":n.updateAnimationConfig({wireCurveStrength:+e});break;case"Signal Multi: Wire Pulse Speed":n.updateAnimationConfig({wirePulseSpeed:+e});break;case"Signal Multi: Particle Size":n.updateAnimationConfig({particleSize:+e});break;case"Signal Multi: Particle Glow":n.updateAnimationConfig({particleGlow:+e});break;case"Signal Multi: Particle Travel Time":n.updateAnimationConfig({particleTravelTime:+e});break;case"Signal Multi: Particle Color":n.updateAnimationConfig({particleColor:e});break}}catch(i){console.error("Config update error:",i)}},100)}}),x({title:"Signal Multi Configuration"})}catch(n){B(n)}});function B(n){const t=document.createElement("div");Object.assign(t.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 0, 0, 0.9)",color:"white",padding:"20px",borderRadius:"10px",fontFamily:"monospace",maxWidth:"80vw",maxHeight:"80vh",overflow:"auto"}),t.innerHTML="<h2>Initialization Error</h2><pre>"+n.message+"</pre><pre>"+n.stack+"</pre>",document.body.appendChild(t)}
